		<style>
		.filename-grid
		{
			overflow: hidden;
			word-break: break-all;
			display: -webkit-box;
			-webkit-line-clamp: 2;
			-webkit-box-orient: vertical;
			height: 2.9em;"
		}
		</style>
        <div class="mediafiles !wrapper !wrapper-content">
            <div class="row">
                <div class="col-lg-12 animated !sfadeInRight fadeInUp">
                    <div class="ibox float-e-margins">
                        <div class="ibox-content p-sm">
                            <div class="file-manager !row">
<!--
                                <h5>Медиа:</h5>
-->

								<div class="btn-group !pull-right ">
									{foreach $menu['format']['list'] as $_item}
										<button class="btn btn-white btn-format {$_item['active']}" link="{$_item['link']}" type="button"><i class="fa {$_item['icon']}"></i></button>
									{end}
								</div>

								<div class="col-md-4 col-xs-8 p-l-none !p-r-none" style="max-width:300px">
									<div class="input-group">
										<input type="text" class="form-control search-input">
										<span class="input-group-btn">
											<button type="button" class="btn btn-white"><i class="fa fa-search"></i></button>
										</span>
									</div>
								</div>



								<div class="!btn-group pull-right">
									{foreach $button as $_btnID => $_button}
									<button class="btn btn-white {$_btnID} !col-xs-6" link="{$_button['link']}"><i class="fa {$_button['icon']}"></i> {$_button['head']}</button>
									{end}

									<input id="{$uid='upload-'.time()}" class="hidden" name="files" type="file"  onchange="mediafilesUpload(this)">
									<label class="btn btn-primary !btn-block !col-xs-6" for="{$uid}">Загрузить файл</label>
                                </div>


                                <div class="clearfix"></div>
                            </div>


							<div class="hr-line-dashed m-sm"></div>


							<div class="!mail-attachment">
								<p>
									{foreach $files['stat'] as $_stat}
										<span class="m-r-md"><strong><i class="fa {$_stat['icon']}"></i></strong> {$_stat['text']}</span>
									{end}
<!--
									<a href="#">Download all</a>
									|
									<a href="#">View all images</a>
-->
								</p>

								<div class="attachment">

									{foreach $files['list'] as $_index => $_fileitem}
									<div class="file-box !col-xs-12" style="width:150px">
										<div class="file ">

												<div style="position: absolute; left:0.5em; top:0.5em; z-index:10">
													<input type="checkbox" name="files-select" value="{$_index}" class="i-checks">
												</div>

												<div style="position: absolute; right:0.5em; top:0.5em; z-index:10">
<!--
													<small class=" text-primary" > <button title="Удалить файл" class="button-file-delete fa fa-trash btn text-primary !btn-white btn-default btn-circle btn-outline"></button> </small>
-->
							<!--
													<small class=" text-primary"> <button  class="fa fa-download btn btn-white btn-default btn-circle btn-outline"></button> </small>
							-->
												</div>

												<a target="_blank" href="{$_fileitem['link']}" title="{$_fileitem['name']}">
												<span class="corner"></span>
													{if     'image' == $_fileitem['format']} <div class="image"> <img class="img-responsive" loading="lazy" src="{$_fileitem['link']}"> </div>
													{elseif 'video' == $_fileitem['format']} <div class="image"> <video src="{$_fileitem['link']}#t=2"></video>         </div>
													{elseif !$_fileitem['format']}           <div class="icon">  <i class="fa fa-file"></i>                              </div>
													{else}
														<div class="icon"> <i class="{$_fileitem['icon']}"></i></div>
													{end}

												<div class="file-name">
													<div class="filename-grid">{$_fileitem['name']}</div>
													<!-- <br> -->
													<small class="mt-xs mt-none">
														{$_fileitem['size']}

														<div class="btn-group pull-right">
															<a data-toggle="dropdown" aria-expanded="true"><strong class="badge pull-right">{$_fileitem['ext']? $_fileitem['ext']: '☵'}</strong></a>

															<ul class="dropdown-menu" style="width:300px">
																<li class="m-sm">
																	{foreach $_fileitem as $_ffield => $_ffieldvalue}
																		<span><strong>{$_ffield}:</strong> {$_ffieldvalue}</span>
																		<br>
																	{end}
																</li>
															</ul>
														</div>
													</small>
												</div>
												</a>
							<!--
											<div class="p-l-xs p-r-xs m-t-xs">
												<small class="mt-xs">{= round($_fileitem['size']/1024/1024, 3)} Mb</small>
												<small class="pull-right" > <button style="margin-top:-1em" class="fa fa-trash btn btn-white btn-default btn-circle btn-outline"></button> </small>
												<small class="pull-right" > <button style="margin-top:-1em" class="fa fa-download btn btn-white btn-default btn-circle btn-outline"></button> </small>
											</div>
							-->
										</div>
									</div>
									{end}

									<div class="clearfix"></div>
								</div>
							</div>


                        </div>
                    </div>
                </div>
			</div>
		</div>


























    <script>
        $(document).ready(function()
        {
            $('.mediafiles .i-checks').iCheck(
            {
		        checkboxClass: 'icheckbox_square-green',
		        radioClass: 'iradio_square-green',
		    });

            $('.mediafiles .btn-reload').click(function ()
            {
                btn = $(this);
                mediafilesAnimateLoad(btn, true);
				mediafilesReload(this, $(this).attr('link'));
                mediafilesAnimateLoad(btn, false);
            });

			$('.mediafiles .btn-format').click(function ()
            {
				mediafilesReload(this, $(this).attr('link'));
			});

			$('.mediafiles .btn-delete').click(function ()
            {
				//Ничего не выбрано
				if (!mediafilesSelected(this)?.length) return false;
				//Не подтвердили
				if (!confirm("Вы уверены, что хотите выполнить это действие?")) return false;

				console.log(mediafilesSelected(this));
			});

			$('.mediafiles .search-input').on('input', function()
			{
				let text = $(this).val();

				$('.mediafiles .filename-grid').each(function()
				{
					if ($(this).text().search(new RegExp(`${text}`, 'i')) < 0 && text != '')
					{
						$(this).closest('.file-box').hide("slow");
						//~ $(this).closest('.file-box').css("opacity", "0.15");

					} else {
						$(this).closest('.file-box').show("slow");
						//~ $(this).closest('.file-box').css("opacity", "1");
					}
				});
			});
        });

		function mediafilesSelected(section)
		{
			var flist = section	? $(section).closest(".mediafiles").find("input[name='files-select']:checked")
								: $(".mediafiles").find("input[name='files-select']:checked");

			var result = [];

			flist.each(function( index )
			{
				result.push($( this ).val());
			});

			return result;
		}

		function mediafilesUpload(elem)
		{

			// создаем объект FormData, его будем передавать по Ajax
			var formData = new FormData();

			// Получаем список объектов File
			var files = $(elem).get(0).files;

			for (let i = 0; i < files.length; i++)
			{
				//~ console.log("Имя файла: " + files[i].name);
				//~ console.log("Размер файла: " + files[i].size + " байт");
				//~ console.log("Тип файла: " + files[i].type);

				formData.append('uploadfile-'+i, files[i]);
			}

			$.ajax({
				type: 'POST',
				url: 'admin/content/mediafiles/listing', // Обработчик
				data: formData,
				processData: false,  // tell jQuery not to process the data
				contentType: false,  // tell jQuery not to set contentType
				success: function(data)
				{
					//~ toastr.success(data);
					$(elem).closest(".mediafiles").parent().html(data);
				},
				error:  function()
				{
					toastr.warning(data);
				}
			});
		}

		function mediafilesReload(elem, url = "admin/content/mediafiles/listing")
		{
			elem ? $(elem).closest(".mediafiles").parent().load(url)
				 : $(".mediafiles").parent().load(url);
		}

		function mediafilesAnimateLoad(btn, state)
		{
			if (state)
			{
				btn.children().addClass('fa-spin');
				btn.contents().last().replaceWith(" Обновление");
			} else {
				setTimeout(function () {
					btn.children().removeClass('fa-spin');
					btn.contents().last().replaceWith(" Индексировать");
				}, 2000);
			}
		}


    </script>
